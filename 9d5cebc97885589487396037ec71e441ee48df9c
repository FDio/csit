{
  "comments": [
    {
      "key": {
        "uuid": "3a46342e_e30c7fe7",
        "filename": "resources/tools/testbed-setup/ansible/roles/azure/tasks/main.yaml",
        "patchSetId": 5
      },
      "lineNbr": 10,
      "author": {
        "id": 1263
      },
      "writtenOn": "2020-02-04T17:22:10Z",
      "side": 1,
      "message": "All these dependency lists will be hard to maintain if dispersed in many files in slightly differing copies. Can we create one \"kitchen sink\" list and \"import\" it everywhere needed?\n\nThe \"kitchen sink\" list can be divided into sections with comments on who needs what, see csit root requirements.txt file.",
      "range": {
        "startLine": 10,
        "startChar": 2,
        "endLine": 10,
        "endChar": 5
      },
      "revId": "9d5cebc97885589487396037ec71e441ee48df9c",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0113a766_c2ac406e",
        "filename": "resources/tools/testbed-setup/ansible/roles/azure/tasks/main.yaml",
        "patchSetId": 5
      },
      "lineNbr": 10,
      "author": {
        "id": 76
      },
      "writtenOn": "2020-02-04T18:57:18Z",
      "side": 1,
      "message": "No/yes, from the best practice it shows that ansible must be more modular forward to reuse roles in different environments. Thus I cannot put all into one file as those modules must be independent on each other. (To easy copy out).\n\nExample: I want to only install T-Rex but not WRK in Azure. Or I want to install something else in Vagrant local than on bare-metal and then on AWS.\n\nI also want to have quick way to copy T-Rex out to be independed role and resuse elsewhere. I will create default/main.yaml for each role with its (PIP|APT|YUM) lists but that is all for now.\n\nThis is because T-Rex has its own requirements. Imagine it similarily to Pyhon imports. You also do not have one large import file storing imports for every file.",
      "parentUuid": "3a46342e_e30c7fe7",
      "range": {
        "startLine": 10,
        "startChar": 2,
        "endLine": 10,
        "endChar": 5
      },
      "revId": "9d5cebc97885589487396037ec71e441ee48df9c",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "77b59e53_6d887f90",
        "filename": "resources/tools/testbed-setup/ansible/roles/azure/tasks/main.yaml",
        "patchSetId": 5
      },
      "lineNbr": 10,
      "author": {
        "id": 1263
      },
      "writtenOn": "2020-02-06T12:03:19Z",
      "side": 1,
      "message": "Hmm, so ansible is more flexible. CSIT bash scripts are less flexible, that is why PAL dependencies are merged with Robot dependencies.\n\n\u003e one large import file storing imports for every file.\n\nYou mean like resources/libraries/robot/shared/default.robot?\n\nI do not have preference between \"centralized\" (one big list) and \"decentralized\" (many small lists).\n\nBut I am against copying, if we can call a function instead.\nI guess in this case my question is whether ansible can install to pip in a virtualenv? If yes, we can call ansible task like this instead of [1] (path is configurable just because some jobs have CSIT cloned directly to the workspace, some have VPP cloned there with CSIT as a subdirectory).\n\n[1] https://github.com/FDio/csit/blob/2cf0755933dac3e95c10928347996bad3cbe0a42/resources/libraries/bash/function/common.sh#L128",
      "parentUuid": "0113a766_c2ac406e",
      "range": {
        "startLine": 10,
        "startChar": 2,
        "endLine": 10,
        "endChar": 5
      },
      "revId": "9d5cebc97885589487396037ec71e441ee48df9c",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "7c5e390c_fadb9c67",
        "filename": "resources/tools/testbed-setup/ansible/roles/azure/tasks/main.yaml",
        "patchSetId": 5
      },
      "lineNbr": 10,
      "author": {
        "id": 76
      },
      "writtenOn": "2020-02-07T20:37:29Z",
      "side": 1,
      "message": "\u003e You mean like resources/libraries/robot/shared/default.robot?\n\nYes (still robot cleanup is needed) but at least nobody is porting them out. While in ansible, having modules is a must to be able to reuse.\n \n\u003e I do not have preference between \"centralized\" (one big list) and \"decentralized\" (many small lists).\n\u003e \n\u003e But I am against copying, if we can call a function instead.\n\nRight now the only duplicates co-exist between PIP lists (main, ansible, docker_image). I still need to solve Chicken-egg problem of who is first Ansible-calls-CSIT, or CSIT-calls-ansible. In ansible PIP lists is pre-fetch to eliminate redownload, while in bash they are used on run basis. I will be thinking of how to merge. \n\n\u003e I guess in this case my question is whether ansible can install to pip in a virtualenv? If yes, we can call ansible task like this instead of [1] (path is configurable just because some jobs have CSIT cloned directly to the workspace, some have VPP cloned there with CSIT as a subdirectory).\n\nIt is possible to do by ansible (like it is done in vagrant). It just take few iteration to get there. I think with current design of Ansible we are ready to get there.  Regarding CSIT nesting that should not be hard to solve.",
      "parentUuid": "77b59e53_6d887f90",
      "range": {
        "startLine": 10,
        "startChar": 2,
        "endLine": 10,
        "endChar": 5
      },
      "revId": "9d5cebc97885589487396037ec71e441ee48df9c",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "69fa4ee6_55a0b66f",
        "filename": "resources/tools/testbed-setup/ansible/roles/azure/tasks/main.yaml",
        "patchSetId": 5
      },
      "lineNbr": 10,
      "author": {
        "id": 1263
      },
      "writtenOn": "2020-02-17T18:01:33Z",
      "side": 1,
      "message": "\u003e CSIT-calls-ansible\n\u003e in bash they are used on run basis\n\nWe definitely have this part, e.g. bash entry scripts calling ansible for testbed cleanup.\n\n\u003e Ansible-calls-CSIT\n\u003e In ansible PIP lists is pre-fetch to eliminate redownload\n\nThis sounds to me as a different ansible usage. Pre-fetching is fine for creation of images for Jenkins executors. But even in that case we want per-run tasks to apply the code from the currently checked-out CSIT (Jenkins image can be older than CSIT master).\n\nI think the hard part is selecting defining which tasks should be executed only once (per-executor or per-testbed), and which tasks should be executed per-run. Too much tasks per-run is too slow, too little tasks per-run is too sensitive to the initial setup (mainly for downstream labs who are not monitoring latest CSIT lab tweaks).\n\n\u003e we are ready to get there\n\n+1.",
      "parentUuid": "7c5e390c_fadb9c67",
      "range": {
        "startLine": 10,
        "startChar": 2,
        "endLine": 10,
        "endChar": 5
      },
      "revId": "9d5cebc97885589487396037ec71e441ee48df9c",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1a29e59f_3aee95b3",
        "filename": "resources/tools/testbed-setup/ansible/roles/azure/tasks/main.yaml",
        "patchSetId": 5
      },
      "lineNbr": 10,
      "author": {
        "id": 76
      },
      "writtenOn": "2020-02-18T06:45:45Z",
      "side": 1,
      "message": "The whole problem is i guess elsewhere.\n\nvirtualenv was meant to isolate environment (having exact version etc.). In our infra this roles is supplied by docker images. (just laziness of some, prevents us to use versioning on them). So we do not even need the virtualenv (which adds complexity) we only need versioning of docker images which is currently hard to achieve. For physical infra we do not need it either.\n\nbut to do that:\n\n- name: Create virtualenv\n  pip:\n    name: \n      - package1\n      - package2\n    virtualenv: ./env\n    virtualenv_site_packages: yes\n    delegate_to: 127.0.0.1\n\nor \n\n- name: Create virtualenv\n  pip:\n    requirements: {{ csit_dir }}/requirements.txt\n    virtualenv: ./env\n    virtualenv_site_packages: yes\n    delegate_to: 127.0.0.1\n\n- name \n  template: src\u003dvenv_exec.j2 dest\u003d{{ venv }}/exec mode\u003d755\n\nExec wrapper:\n\n#!/bin/bash\nsource {{ venv }}/bin/activate\n$@\n\n\nrunning pybot:\n./exec pybot BLAH.....\n\nSo easy....\n\nor \n\n- name: Run CSIT\n  command: \"{{ venv }}/exec pybot BLAH...\"",
      "parentUuid": "69fa4ee6_55a0b66f",
      "range": {
        "startLine": 10,
        "startChar": 2,
        "endLine": 10,
        "endChar": 5
      },
      "revId": "9d5cebc97885589487396037ec71e441ee48df9c",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "24d6a4b2_301aa478",
        "filename": "resources/tools/testbed-setup/ansible/roles/azure/tasks/ubuntu_bionic.yaml",
        "patchSetId": 5
      },
      "lineNbr": 5,
      "author": {
        "id": 1263
      },
      "writtenOn": "2020-02-04T17:22:10Z",
      "side": 1,
      "message": "See the previous comment about dependency lists.",
      "range": {
        "startLine": 5,
        "startChar": 2,
        "endLine": 5,
        "endChar": 5
      },
      "revId": "9d5cebc97885589487396037ec71e441ee48df9c",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "53565c8f_0da2e1f7",
        "filename": "resources/tools/testbed-setup/ansible/roles/common/tasks/ubuntu_bionic.yaml",
        "patchSetId": 5
      },
      "lineNbr": 11,
      "author": {
        "id": 1263
      },
      "writtenOn": "2020-02-04T17:22:10Z",
      "side": 1,
      "message": "A list to merge into \"kitchen sink\".",
      "range": {
        "startLine": 11,
        "startChar": 2,
        "endLine": 11,
        "endChar": 5
      },
      "revId": "9d5cebc97885589487396037ec71e441ee48df9c",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "79da50da_2e7285c1",
        "filename": "resources/tools/testbed-setup/ansible/roles/iperf/tasks/ubuntu_bionic.yaml",
        "patchSetId": 5
      },
      "lineNbr": 5,
      "author": {
        "id": 1263
      },
      "writtenOn": "2020-02-04T17:22:10Z",
      "side": 1,
      "message": "A list to merge into \"kitchen sink\".",
      "range": {
        "startLine": 5,
        "startChar": 2,
        "endLine": 5,
        "endChar": 5
      },
      "revId": "9d5cebc97885589487396037ec71e441ee48df9c",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a88423a0_2e53cd9c",
        "filename": "resources/tools/testbed-setup/ansible/roles/trex/tasks/main.yaml",
        "patchSetId": 5
      },
      "lineNbr": 37,
      "author": {
        "id": 1263
      },
      "writtenOn": "2020-02-04T17:22:10Z",
      "side": 1,
      "message": "I wonder why is this not part of TRex already. Licensing issues? If yes, I am not sure we are allowed to apply the patch.\nIf no (Contributors not eager to add command line options needed? TRex committers to busy to merge otherwise good contribution?), can we help?",
      "range": {
        "startLine": 37,
        "startChar": 24,
        "endLine": 37,
        "endChar": 37
      },
      "revId": "9d5cebc97885589487396037ec71e441ee48df9c",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bc2690b3_5ba807e9",
        "filename": "resources/tools/testbed-setup/ansible/roles/trex/tasks/main.yaml",
        "patchSetId": 5
      },
      "lineNbr": 37,
      "author": {
        "id": 76
      },
      "writtenOn": "2020-02-04T18:59:39Z",
      "side": 1,
      "message": "I am pretty sure they know about the problem:\n\nhttps://github.com/cisco-system-traffic-generator/trex-core/wiki/Build-For-Azure-Ubuntu-(mlx5)\n\nFor now we will apply patch only for Azure.",
      "parentUuid": "a88423a0_2e53cd9c",
      "range": {
        "startLine": 37,
        "startChar": 24,
        "endLine": 37,
        "endChar": 37
      },
      "revId": "9d5cebc97885589487396037ec71e441ee48df9c",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "faefaf9a_00ef20f1",
        "filename": "resources/tools/testbed-setup/ansible/roles/trex/tasks/main.yaml",
        "patchSetId": 5
      },
      "lineNbr": 37,
      "author": {
        "id": 1263
      },
      "writtenOn": "2020-02-06T12:03:19Z",
      "side": 1,
      "message": "Alright, looks like patching really is the way TRex recommends.",
      "parentUuid": "bc2690b3_5ba807e9",
      "range": {
        "startLine": 37,
        "startChar": 24,
        "endLine": 37,
        "endChar": 37
      },
      "revId": "9d5cebc97885589487396037ec71e441ee48df9c",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "93f9f929_338d3383",
        "filename": "resources/tools/testbed-setup/ansible/roles/trex/tasks/ubuntu_bionic.yaml",
        "patchSetId": 5
      },
      "lineNbr": 5,
      "author": {
        "id": 1263
      },
      "writtenOn": "2020-02-04T17:22:10Z",
      "side": 1,
      "message": "A list to merge into \"kitchen sink\".",
      "range": {
        "startLine": 5,
        "startChar": 2,
        "endLine": 5,
        "endChar": 5
      },
      "revId": "9d5cebc97885589487396037ec71e441ee48df9c",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "81c89cf8_d00a2c0a",
        "filename": "resources/tools/testbed-setup/ansible/roles/wrk/tasks/ubuntu_bionic.yaml",
        "patchSetId": 5
      },
      "lineNbr": 5,
      "author": {
        "id": 1263
      },
      "writtenOn": "2020-02-04T17:22:10Z",
      "side": 1,
      "message": "A list to merge into \"kitchen sink\".",
      "range": {
        "startLine": 5,
        "startChar": 2,
        "endLine": 5,
        "endChar": 5
      },
      "revId": "9d5cebc97885589487396037ec71e441ee48df9c",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": true
    }
  ]
}