CSIT Release Notes
==================

Changes in CSIT |release| - to be updated
-------------------------

#. VPP performance test environment changes

    - further VM and vhost-user test environment optimizations - Qemu virtio queue size increased from default value of 256 to 1024
    - addition of HW cryptodev devices in all three LF FD.io physical testbeds

#. Added tests (to be updated)

    - NICs

      - Intel x710 (L2 Bridge Domain switched-forwarding, vhost-user)
      - Cisco VIC1385 (L2 Bridge Domain switched-forwarding)
      - Cisco VIC1227 (L2 Bridge Domain switched-forwarding)

    - vhost-user tests with VM

      - L2 Bridge Domain switched-forwarding with Intel x710 NIC
      - L2 Bridge Domain switched-forwarding with VxLAN and Intel x520 NIC
      - L2 Bridge Domain switched-forwarding with Intel xl710 NIC

    - Tests with VxLAN

      - L2 Bridge Domain switched-forwarding with Intel x520 NIC
      - L2 Bridge Domain switched-forwarding with vhost-user, VM and Intel x520
        NIC

Performance Improvements - to be updated
------------------------

Substantial improvements in measured packet throughput, with relative increase
of double-digit percentage points, have been observed in a number of CSIT
|release| tests listed below. Relative improvements are calculated against the
test results in CSIT rls1701 report.

NDR Throughput
~~~~~~~~~~~~~~

Non-Drop Rate Throughput discovery tests:

+-------------------+-----------------------------------------------------------------+------------+-----------+----------------------------+
| VPP Functionality | Test Name                                                       | VPP-16.09  | VPP-17.01 | VPP-17.04 | 17.01 to 17.04 |
|                   |                                                                 |   [Mpps]   |  [Mpps]   |   [Mpps]  |  Improvement   |
+===================+=================================================================+============+===========+===========+================+
| L2XC              | 10ge2p1x520: 64B-1t1c-eth-l2xcbase-ndrdisc                      | 9.4        | 12.7      | 13.4      | 6%             |
+-------------------+-----------------------------------------------------------------+------------+-----------+-----------+----------------+
| L2XC              | 10ge2p1xl710: 64B-1t1c-eth-l2xcbase-ndrdisc                     | 9.5        | 12.2      | 12.4      | 2%             |
+-------------------+-----------------------------------------------------------------+------------+-----------+-----------+----------------+
| L2XC dot1ad       | 10ge2p1x520: 64B-1t1c-dot1ad-l2xcbase-ndrdisc                   | 7.4        | 8.8       | 9.3       | 6%             |
+-------------------+-----------------------------------------------------------------+------------+-----------+-----------+----------------+
| L2XC dot1q        | 10ge2p1x520: 64B-1t1c-dot1q-l2xcbase-ndrdisc                    | 7.5        | 8.8       | 9.2       | 5%             |
+-------------------+-----------------------------------------------------------------+------------+-----------+-----------+----------------+
| L2XC VxLAN        | 10ge2p1x520: 64B-1t1c-ethip4vxlan-l2xcbase-ndrdisc              | 5.4        | 6.5       | 6.8       | 5%             |
+-------------------+-----------------------------------------------------------------+------------+-----------+-----------+----------------+
| L2XC-vhost-VM     | 10ge2p1x520: 64B-1t1c-eth-l2xcbase-eth-2vhost-1vm-ndrdisc       | 0.5        | 2.8       | 3.2       | 14%            |
+-------------------+-----------------------------------------------------------------+------------+-----------+-----------+----------------+
| L2BD              | 10ge2p1x520: 64B-1t1c-eth-l2bdbasemaclrn-ndrdisc                | 7.8        | 10.4      | 10.8      | 4%             |
+-------------------+-----------------------------------------------------------------+------------+-----------+-----------+----------------+
| L2BD-vhost-VM     | 10ge2p1x520: 64B-1t1c-eth-l2bdbasemaclrn-eth-2vhost-1vm-ndrdisc | 0.4        | 2.7       | 3.4       | 26%            |
+-------------------+-----------------------------------------------------------------+------------+-----------+-----------+----------------+
| IPv4              | 10ge2p1x520: 64B-1t1c-ethip4-ip4base-ndrdisc                    | 8.7        | 9.7       | 10.6      | 9%             |
+-------------------+-----------------------------------------------------------------+------------+-----------+-----------+----------------+
| IPv4 COP          | 10ge2p1x520: 64B-1t1c-ethip4-ip4base-copwhtlistbase-ndrdisc     | 7.1        | 8.3       | 9.0       | 8%             |
+-------------------+-----------------------------------------------------------------+------------+-----------+-----------+----------------+
| IPv4 iAcl         | 10ge2p1x520: 64B-1t1c-ethip4-ip4base-iacldstbase-ndrdisc        | 6.9        | 7.6       | 8.3       | 9%             |
+-------------------+-----------------------------------------------------------------+------------+-----------+-----------+----------------+
| IPv4 vhost        | 10ge2p1x520: 64B-1t1c-ethip4-ip4base-eth-2vhost-1vm-ndrdisc     | 0.3        | 2.6       | 3.1       | 19%            |
+-------------------+-----------------------------------------------------------------+------------+-----------+-----------+----------------+
| IPv6              | 10ge2p1x520: 78B-1t1c-ethip6-ip6base-ndrdisc                    | 3.0        | 7.3       | 8.5       | 16%            |
+-------------------+-----------------------------------------------------------------+------------+-----------+-----------+----------------+

PDR Throughput
~~~~~~~~~~~~~~

Partial Drop Rate thoughput discovery tests with packet Loss Tolerance of 0.5%:

+-------------------+-----------------------------------------------------------------+-----------+-----------+-------------------------+
| VPP Functionality | Test Name                                                       | VPP-16.09 | VPP-17.01 | VPP-17.04 | Relative    |
|                   |                                                                 |   [Mpps]  |  [Mpps]   |   [Mpps]  | Improvement |
+===================+=================================================================+===========+===========+===========+=============+
| L2XC              | 10ge2p1x520: 64B-1t1c-eth-l2xcbase-pdrdisc                      | 9.4       | 12.7      | 13.4      |   %         |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| L2XC dot1ad       | 10ge2p1x520: 64B-1t1c-dot1ad-l2xcbase-pdrdisc                   | 7.4       | 8.8       | 9.3       |   %         |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| L2XC dot1q        | 10ge2p1x520: 64B-1t1c-dot1q-l2xcbase-pdrdisc                    | 7.5       | 8.8       | 9.5       |   %         |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| L2XC VxLAN        | 10ge2p1x520: 64B-1t1c-ethip4vxlan-l2xcbase-pdrdisc              | 5.4       | 6.5       | 6.8       |   %         |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| L2XC-vhost-VM     | 10ge2p1x520: 64B-1t1c-eth-l2xcbase-eth-2vhost-1vm-pdrdisc       | 2.6       | 3.2       | 3.2       |   %         |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| L2BD              | 10ge2p1x520: 64B-1t1c-eth-l2bdbasemaclrn-pdrdisc                | 7.8       | 10.6      | 11.1      |   %         |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| L2BD-vhost-VM     | 10ge2p1x520: 64B-1t1c-eth-l2bdbasemaclrn-eth-2vhost-1vm-pdrdisc | 2.1       | 2.9       | 3.2       |   %         |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv4              | 10ge2p1x520: 64B-1t1c-ethip4-ip4base-pdrdisc                    | 8.7       | 9.7       | 10.6      |   %         |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv4 COP          | 10ge2p1x520: 64B-1t1c-ethip4-ip4base-copwhtlistbase-pdrdisc     | 7.1       | 8.3       | 9.2       |   %         |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv4 vhost        | 10ge2p1x520: 64B-1t1c-ethip4-ip4base-eth-2vhost-1vm-pdrdisc     | 2.0       | 2.7       | 3.2       |   %         |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+

Measured improvements are in line with VPP code optimizations listed in
`VPP-17.04 release notes
<https://docs.fd.io/vpp/17.04/release_notes_1704.html>`_.

Additionally, vhost-VM performance improvements are due to both VPP code
optimizations as well as due to the FD.io CSIT Linux KVM test environment
optimizations for vhost-VM tests - see section "2.1.7. Methodology: KVM VM
vhost".


Other Performance Changes - to be updated
-------------------------

Other changes in measured packet throughput, with either minor relative
increase or decrease, have been observed in a number of CSIT |release| tests
listed below. Relative changes are calculated against the test results in CSIT
rls1701 report.

NDR Throughput
~~~~~~~~~~~~~~

Non-Drop Rate Throughput discovery tests:

+-------------------+-----------------------------------------------------------------+-----------+-----------+-------------------------+
| VPP Functionality | Test Name                                                       | VPP-16.09 | VPP-17.01 | VPP-17.04 | Relative    |
|                   |                                                                 |   [Mpps]  |  [Mpps]   |   [Mpps]  | Change      |
+===================+=================================================================+===========+===========+===========+=============+
| IPv4 FIB 200k     | 10ge2p1x520: 64B-1t1c-ethip4-ip4scale200k-ndrdisc               | 8.5       | 9.0       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv4 FIB 20k      | 10ge2p1x520: 64B-1t1c-ethip4-ip4scale20k-ndrdisc                | 8.5       | 9.0       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv4 FIB 2M       | 10ge2p1x520: 64B-1t1c-ethip4-ip4scale2m-ndrdisc                 | 8.5       | 7.8       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv4 Policer      | 10ge2p1x520: 64B-1t1c-ethip4-ip4base-ipolicemarkbase-ndrdisc    | 6.9       | 7.4       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv4 LISP         | 10ge2p1x520: 64B-1t1c-ethip4lispip4-ip4base-ndrdisc             | 4.4       | 4.8       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv6 COP          | 10ge2p1x520: 78B-1t1c-ethip6-ip6base-copwhtlistbase-ndrdisc     | 6.1       | 6.1       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv6 FIB 200k     | 10ge2p1x520: 78B-1t1c-ethip6-ip6scale200k-ndrdisc               | 6.5       | 5.3       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv6 FIB 20k      | 10ge2p1x520: 78B-1t1c-ethip6-ip6scale20k-ndrdisc                | 6.9       | 6.5       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv6 FIB 2M       | 10ge2p1x520: 78B-1t1c-ethip6-ip6scale2m-ndrdisc                 | 5.3       | 4.2       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv6 iAcl         | 10ge2p1x520: 78B-1t1c-ethip6-ip6base-iacldstbase-ndrdisc        | 6.5       | 6.1       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+

PDR Throughput
~~~~~~~~~~~~~~

Partial Drop Rate thoughput discovery tests with packet Loss Tolerance of 0.5%:

+-------------------+-----------------------------------------------------------------+-----------+-----------+-------------------------+
| VPP Functionality | Test Name                                                       | VPP-16.09 | VPP-17.01 | VPP-17.04 | Relative    |
|                   |                                                                 |   [Mpps]  |  [Mpps]   |   [Mpps]  | Change      |
+===================+=================================================================+===========+===========+===========+=============+
| IPv4 FIB 200k     | 10ge2p1x520: 64B-1t1c-ethip4-ip4scale200k-pdrdisc               | 8.5       | 9.0       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv4 FIB 20k      | 10ge2p1x520: 64B-1t1c-ethip4-ip4scale20k-pdrdisc                | 8.5       | 9.0       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv4 FIB 2M       | 10ge2p1x520: 64B-1t1c-ethip4-ip4scale2m-pdrdisc                 | 8.3       | 8.1       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv4 iAcl         | 10ge2p1x520: 64B-1t1c-ethip4-ip4base-iacldstbase-pdrdisc        | 7.1       | 7.6       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv4 Policer      | 10ge2p1x520: 64B-1t1c-ethip4-ip4base-ipolicemarkbase-pdrdisc    | 7.1       | 7.4       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv4 LISP         | 10ge2p1x520: 64B-1t1c-ethip4lispip4-ip4base-pdrdisc             | 4.6       | 4.8       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv6              | 10ge2p1x520: 78B-1t1c-ethip6-ip6base-pdrdisc                    | 7.7       | 7.3       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv6 COP          | 10ge2p1x520: 78B-1t1c-ethip6-ip6base-copwhtlistbase-pdrdisc     | 6.1       | 6.1       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv6 FIB 200k     | 10ge2p1x520: 78B-1t1c-ethip6-ip6scale200k-pdrdisc               | 6.9       | 5.3       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv6 FIB 20k      | 10ge2p1x520: 78B-1t1c-ethip6-ip6scale20k-pdrdisc                | 6.9       | 6.5       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv6 FIB 2M       | 10ge2p1x520: 78B-1t1c-ethip6-ip6scale2m-pdrdisc                 | 5.3       | 4.2       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+
| IPv6 iAcl         | 10ge2p1x520: 78B-1t1c-ethip6-ip6base-iacldstbase-pdrdisc        | 6.5       | 6.1       |           |  %          |
+-------------------+-----------------------------------------------------------------+-----------+-----------+-----------+-------------+

Known Issues - to be updated
------------

Here is the list of known issues in CSIT |release| for VPP performance tests: (to be updated)

+---+-------------------------------------------------+-----------------------------------------------------------------+
| # | Issue                                           | Description                                                     |
+---+-------------------------------------------------+-----------------------------------------------------------------+
| 1 | Sporadic IPv4 routed-forwarding NDR discovery   | Suspected issue with DPDK IPv4 checksum calculation.            |
|   | test failures for 1518B frame size              | Observed frequency: sporadic, ca. 20% to 30% of test runs.      |
+---+-------------------------------------------------+-----------------------------------------------------------------+
| 3 | Vic1385 and Vic1227 performance                 | Low performance of NDR results. Big difference between NDR and  |
|   |                                                 | PDR.                                  .                         |
+---+-------------------------------------------------+-----------------------------------------------------------------+
| 4 | Sporadic NDR discovery test failures on x520    | Suspected issue with HW settings (BIOS, FW) in LF               |
|   |                                                 | infrastructure. Issue can't be replicated outside LF.           |
+---+-------------------------------------------------+-----------------------------------------------------------------+
| 5 | Non-repeatible zig-zagging NDR throughput       | Suspected NIC driver issue in multi-thread multi-core operation |
|   | results for multi-thread multi-core tests       | affectin NDR throughput. Applies to XL710 and X710 NICs tested. |
|   | - 2t2c, 4t4c - for some tested NICs.            |                                                                 |
+---+-------------------------------------------------+-----------------------------------------------------------------+

