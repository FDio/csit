{
    "$id": "https://fd.io/FIXME/CSIT/UTI/test_case/info/0.1.0",
    "$schema": "https://json-schema.org/draft/2020-12/schema",
    "description": "Schema for info output of test case.",
    "type": "object",
    "properties": {
        "duration": {
            "$ref": "#/$defs/types/nonnegative_number",
            "description": "A derived quantity, present only in info output files. \n Difference between start_time and end_time, in seconds."
        },
        "end_time": {
            "$ref": "#/$defs/types/date_time",
            "description": "UTC date and time in ISO format, specifying calendar time just before test case ended (at the end of test case teardown)."
        },
        "log": {
            "$ref": "#/$defs/types/empty_array",
            "description": "No log items are implemented in the current version, but the (empty) list is present to simplify logic in multi-version importers."
        },
        "message": {
            "type": "string",
            "description": "Value taken directly from TEST_MESSAGE Robot variable, read at the end of test case (teardown). \n If status is PASS, it contains output as set by test case code (current format depends on test type and may change any time). If status is FAIL, it contains information from the exception that caused the failure, probably with additional exceptions from teardown keywords."
        },
        "results": {
            "oneOf": [
                {
                    "type": "object",
                    "properties": {
                        "$ref": "#/$defs/results/mrr"
                    },
                    "required": [
                        "mrr"
                    ],
                    "description": "TODO: Add link to methodology document for MRR test type."
                },
                {
                    "type": "object",
                    "properties": {
                        "$ref": "#/$defs/results/ndrpdr"
                    },
                    "required": [
                        "ndrpdr"
                    ],
                    "description": "TODO: Add link to methodology document for NDRPDR test type."
                },
                {
                    "type": "object",
                    "properties": {
                        "$ref": "#/$defs/results/soak"
                    },
                    "required": [
                        "soak"
                    ],
                    "description": "TODO: Add link to methodology document for SOAK test type."
                },
                {
                    "properties": {},
                    "description": "This case represents a test with no specific resut (outside message), e.g. device test; or a test with result not parsed into this version of model yet, e.g. GSO test."
                }
            ]
        },
        "start_time": {
            "$ref": "#/$defs/types/date_time",
            "description": "UTC date and time in ISO format, specifying calendar time just after test case started (at the start of test setup)."
        },
        "status": {
            "type": "string",
            "enum": [
                "PASS",
                "FAIL"
            ],
            "description": "Value taken directly from TEST_STATUS Robot variable. It is PASS or FAIL, read at the end of test case (teardown)."
        },
        "sut_type": {
            "type": "string",
            "enum": [
                "VPP",
                "DPDK"
            ],
            "description": "Identifier for System Under Test. Some tests may not set this, the property is not present in that case. For example, TRex tests use only Traffic Generator, there is no SUT."
        },
        "sut_version": {
            "type": "string",
            "description": "Some tests may not set this, the entry is not present in that case. \n The value should correspond to sut_type. For VPP type, the value is taken from 'version' field of reply to show_version API call."
        },
        "tags": {
            "type": "array",
            "items": {
                "type": "string"
            },
            "description": "The list of strings comes directly from Robot variable TEST_TAGS. \n The content should include both static and dynamic tags at the end of test case (teardown)."
        },
        "test_documentation": {
            "type": "string",
            "description": "Value taken directly from TEST_DOCUMENTATION Robot variable. The content is what you see in suite file at test case definition, which is usually empty as CSIT uses data driven test cases."
        },
        "test_id": {
            "type": "string",
            "description": "A derived quantity, present only in info output files. \n This entry has a string value, composed from suite name and test name, by converting to lowercase and connected with dot. Also, any space is replaced by underscore. \n TODO: Test with underscores and dots, both in suite and test part."
        },
        "test_name": {
            "type": "string",
            "description": "Value taken directly from TEST_NAME Robot variable. It consists of CameCase name of this test case."
        },
        "test_type": {
            "type": "string",
            "enum": [
                "mrr",
                "ndrpdr",
                "soak"
            ],
            "description": "Some tests may not set this, the entry is not present in that case (see when results object is empty). \n As the result object contains a property named after the test type, this information is derived, so this appears only in info output."
        },
        "version": {
            "type": "string",
            "constant": "0.2.0",
            "desctiption": "CSIT model version (in semver format) the exporting code adhered to."
        }
    },
    "required": [
        "duration",
        "end_time",
        "log",
        "message",
        "results",
        "start_time",
        "status",
        "tags",
        "test_documentation",
        "test_id",
        "test_name",
        "version"
    ],
    "$defs": {
        "types": {
            "nonnegative_number": {
                "type": "number",
                "minimum": 0
            },
            "nonnegative_integer": {
                "type": "integer",
                "minimum": 0
            },
            "date_time": {
                "type": "string",
                "format": "date-time"
            },
            "empty_array": {
                "type": "array",
                "maxItems": 0
            },
            "rate_unit": {
                "type": "string",
                "enum": [
                    "pps",
                    "cps"
                ]
            }
        },
        "macros": {
            "ndr_or_pdr": {
                "type": "object",
                "properties": {
                    "lower_rate": {
                        "$ref": "#/$defs/types/nonnegative_number",
                        "description": "The lower bound (or min_rate) for the estimate of the particular searched rate (NDR or PDR). \n For rate unit, see 'rate_unit' entry."
                    },
                    "upper_rate": {
                        "$ref": "#/$defs/types/nonnegative_number",
                        "description": "The upper bound (or max_rate) for the estimate of the particular searched rate (NDR or PDR). \n For rate unit, see 'rate_unit' entry."
                    },
                    "lower_bandwidth": {
                        "$ref": "#/$defs/types/nonnegative_number",
                        "description": "This is a derived entity, thus it only appears in info output, and only when rate unit is pps. \n Value specifies the lower bound (or min_rate) for the estimate of the particular searched rate (NDR or PDR). The bandwidth unit of measurement is Gigabits per second (aggregate for both directions)."
                    },
                    "upper_bandwidth": {
                        "$ref": "#/$defs/types/nonnegative_number",
                        "description": "This is a derived entity, thus it only appears in info output, and only when rate unit is pps. \n Value specifies the upper bound (or max_rate) for the estimate of the particular searched rate (NDR or PDR). The bandwidth unit of measurement is Gigabits per second (aggregate for both directions)."
                    }
                },
                "required": [
                    "lower_rate",
                    "upper_rate"
                ]
            },
            "latency_numbers": {
                "type": "object",
                "properties": {
                    "min": {
                        "$ref": "#/$defs/types/nonnegative_integer",
                        "description": "Rounded minimal latency time measured in this trial. See 'latency_unit' entry for the unit of measurement."
                    },
                    "max": {
                        "$ref": "#/$defs/types/nonnegative_integer",
                        "description": "Rounded minimal latency time measured in this trial. See 'latency_unit' entry for the unit of measurement."
                    },
                    "avg": {
                        "$ref": "#/$defs/types/nonnegative_integer",
                        "description": "Rounded average latency time measured in this trial. See 'latency_unit' entry for the unit of measurement."
                    },
                    "hdrh": {
                        "type": "string",
                        "description": "Base64-encoded compressed representation of HDRHistogram of all latency sample times encountered this latency trial. See 'latency_unit' entry for the unit of measurement. \n TODO: Add a link to URL explaining how to decode the data?"
                    }
                },
                "required": [
                    "avg",
                    "hdrh",
                    "max",
                    "min"
                ]
            },
            "latency_for_loads": {
                "type": "object",
                "properties": {
                    "pdr_0": {
                        "$ref": "#/$defs/macros/latency_numbers",
                        "description": "Object related to latency measurement performed at minimal rate (currently 9000 pps)."
                    },
                    "pdr_10": {
                        "$ref": "#/$defs/macros/latency_numbers",
                        "description": "Object related to latency measurement performed at 10% of PDR lower bound, if needed rounded up to minimal rate (currently 9000 pps)."
                    },
                    "pdr_50": {
                        "$ref": "#/$defs/macros/latency_numbers",
                        "description": "Object related to latency measurement performed at 50% of PDR lower bound, if needed rounded up to minimal rate (currently 9000 pps)."
                    },
                    "pdr_90": {
                        "$ref": "#/$defs/macros/latency_numbers",
                        "description": "Object related to latency measurement performed at 90% of PDR lower bound, if needed rounded up to minimal rate (currently 9000 pps)."
                    }
                },
                "required": [
                    "pdr_0",
                    "pdr_10",
                    "pdr_50",
                    "pdr_90"
                ]
            }
        },
        "results": {
            "mrr": {
                "type": "object",
                "properties": {
                    "samples": {
                        "type": "array",
                        "items": {
                            "$ref": "#/$defs/types/nonnegative_number",
                            "description": "Receive rate for one MRR trial. For rate unit, see 'rate_unit' entry. \n Currently, the tests are exporting approximated receive rate. That means the actual trial duration is measured (as opposed to trusting traffic generator to honor its target duration), so the resulting values contain noise from time measurement, and can be lower than the real performance (due to various time overheads)."
                        }
                    },
                    "rate_unit": {
                        "$ref": "#/$defs/types/rate_unit",
                        "description": "A transaction rate unit the samples are expressed in. \n The value is 'pps' (packets per second), or 'cps' (connections per second). \n Unless specified otherwise, this is the aggregated rate (sum of both traffic directions)."
                    },
                    "avg": {
                        "$ref": "#/$defs/types/nonnegative_number",
                        "descrption": "A derived quantity, present only in info output files. \n It is the arithmetic average of the samples list."
                    },
                    "stdev": {
                        "$ref": "#/$defs/types/nonnegative_number",
                        "description": "A derived quantity, present only in info output files. \n It is the standard deviation for the samples list, as computed by jumpavg library."
                    }
                },
                "required": [
                    "samples",
                    "rate_unit",
                    "avg",
                    "stdev"
                ]
            },
            "ndrpdr": {
                "type": "object",
                "properties": {
                    "ndr": {
                        "$ref": "#/$defs/macros/ndr_or_pdr",
                        "description": "The results refer to search for NDR (Non Drop Rate). The accepted loss ratio for NDR is exact zero. \n Note that packets the Traffic Generator did not send are also counted as lost packets."
                    },
                    "pdr": {
                        "$ref": "#/$defs/macros/ndr_or_pdr",
                        "description": "The results refer to search for PDR (Partial Drop Rate). The accepted loss ratio for PDR is half a percent. \n Note that packets the Traffic Generator did not send are also counted as lost packets."
                    },
                    "rate_unit": {
                        "$ref": "#/$defs/types/rate_unit",
                        "description": "A transaction rate unit the rate bounds are expressed in. \n The value is 'pps' (packets per second), or 'cps' (connections per second). \n Unless specified otherwise, this is the aggregated rate (sum of both traffic directions)."
                    },
                    "bandwidth_unit": {
                        "type": "string",
                        "enum": [
                            "Gbps"
                        ],
                        "description": "Unit of measurement for bounds expressed as bandwidth. Currently a constant, but later versions of model may allow more values. \n Only present when rate_unit is pps."
                    },
                    "latency_forward": {
                        "$ref": "#/$defs/macros/latency_for_loads",
                        "description": "Object with results related to latency part of NDRPDR test, for forward traffic direction. It is the direction used in unidirectional traffic profiles. \n ASTF profiles and IMIX STL profiles do not support latency information, so for those tests this object is missing. It is also missing if Traffic Generator fails to return valid latency results for any other reasons, e.g. latency rate is too high for CPU/NIC used."
                    },
                    "latency_reverse": {
                        "$ref": "#/$defs/macros/latency_for_loads",
                        "description": "Object with results related to latency part of NDRPDR test, for reverse traffic diration. This object is not present when unidirectional traffic profiles are used. \n ASTF profiles and IMIX STL profiles do not support latency information, so for those tests this object is missing. It is also missing if Traffic Generator fails to return valid latency results for any other reasons, e.g. latency rate is too high for CPU/NIC used."
                    },
                    "latency_unit": {
                        "type": "string",
                        "enum": [
                            "us"
                        ],
                        "description": "Unit of measurement for latency time. Currently a constant, but later versions of model may allow more values."
                    }
                },
                "required": [
                    "ndr",
                    "pdr",
                    "rate_unit",
                    "latency_unit"
                ]
            },
            "soak": {
                "type": "object",
                "properties": {
                    "lower": {
                        "$ref": "#/$defs/types/nonnegative_number",
                        "description": "The lower bound for the estimate of the critical rate. \n For rate unit, see rate_unit entry."
                    },
                    "upper": {
                        "$ref": "#/$defs/types/nonnegative_number",
                        "description": "The upper bound for the estimate of the critical rate. \n For rate unit, see rate_unit entry."
                    },
                    "rate_unit": {
                        "$ref": "#/$defs/types/rate_unit",
                        "description": "Unit the critical rate bounds are expressed in. \n The value is 'pps' (packets per second), or 'cps' (connections per second). \n Unless specified otherwise, this is the aggregated rate (sum of both traffic directions)."
                    }
                },
                "required": [
                    "lower",
                    "upper",
                    "rate_unit"
                ]
            }
        }
    }
}