---
# file: roles/calibration/tasks/main.yaml

- name: Calibration - Install Distribution - Release - Machine Prerequisites
  package:
    name: "{{ packages | flatten(levels=1) }}"
    state: latest
    update_cache: true
  tags:
    - install-dependencies

- name: Calibration - Run Spectre Meltdown Checker
  raw: "wget -qO - https://meltdown.ovh | sudo bash -s - --no-color"
  async: 60
  poll: 5
  ignore_errors: yes
  register: __spectre_meltdown_output
  tags:
    - check-spectre-meltdown

- debug: var=__spectre_meltdown_output.stdout_lines
  tags:
    - check-spectre-meltdown

- name: Calibration - {{ ansible_machine }} Specific
  include_tasks: "{{ ansible_machine }}.yaml"
  tags:
    - check-machine-specific
    - check-jitter-tool
