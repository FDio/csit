---
# file: roles/calibration/tasks/main.yaml

- name: Calibration - Install Distribution - Release - Machine Prerequisites
  package:
    name: "{{ packages | flatten(levels=1) }}"
    state: latest
    update_cache: true
  tags:
    - install-dependencies

- name: Calibration - Run Spectre Meltdown Checker
  raw: "wget -qO - https://meltdown.ovh | sudo bash -s - --no-color || true"
  register: spectre_meltdown_output
  tags:
    - run-spectre-meltdown-checker

- debug: var=spectre_meltdown_output.stdout_lines
  tags:
    - run-spectre-meltdown-checker

- name: Calibration - {{ ansible_machine }} Specific
  include_tasks: "{{ ansible_machine }}.yaml"
  when: ansible_machine == "x86_64"
  tags:
    - run-jitter-tool
