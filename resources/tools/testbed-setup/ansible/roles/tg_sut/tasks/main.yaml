---
# file: roles/common/tasks/main.yaml

- name: Ubuntu specific
  import_tasks: ubuntu_x86_64.yaml
  when: ansible_distribution|lower == 'ubuntu'

- name: Copy interfaces file
  template:
    src: "files/interfaces_physical"
    dest: "/etc/network/interfaces owner=root group=root mode=644"
  tags: interface-file

- name: Copy sysctl file
  template:
    src: "files/90-csit"
    dest: "/etc/sysctl.d/90-csit.conf owner=root group=root mode=644"
  tags: 90-csit

- name: Copy IRQ load balancing file
  copy:
    src: "files/irqbalance"
    dest: "/etc/default/irqbalance owner=root group=root mode=0644"
  tags: irq

- name: Copy cpufrequtils file
  copy:
    src: "files/cpufrequtils"
    dest: "/etc/default/cpufrequtils owner=root group=root mode=0644"
  tags: cpufrequtils

- name: Copy Python requirements file
  copy:
    src: "files/requirements.txt"
    dest: "/tmp/requirements.txt"
  tags: pip

- name: Set isolcpus and pstate parameter
  lineinfile:
      dest: "/etc/default/grub"
      regexp: '^GRUB_CMDLINE_LINUX= line=GRUB_CMDLINE_LINUX="\"isolcpus={{ isolcpus }} nohz_full={{ isolcpus }} rcu_nocbs={{ isolcpus }} intel_pstate=disable\""'
  notify: ["Update GRUB"]
  tags: grub

- name: Disable ondemand
  service:
    name: "ondemand"
    enabled: "no"
  tags: ondemand

- name: Install PIP requirements
  pip:
    requirements: "/tmp/requirements.txt"
  tags: pip

