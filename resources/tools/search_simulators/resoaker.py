# Copyright (c) 2018 Cisco and/or its affiliates.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at:
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

import math
import logging
import sys

from resources.libraries.python.MLRsearch.ReceiveRateMeasurement import ReceiveRateMeasurement
from SoakMeasurer import SoakMeasurer as measurer
from PLRsearch import PLRsearch as search

logging.basicConfig(level=getattr(logging, "DEBUG"))

tuple_list = [
    (18750000.0, 95624814, 92137289),
    (683828.499755, 3555904, 0),
    (683827.76069, 3624282, 0),
    (683826.860836, 3692660, 0),
    (685237.504388, 3768802, 0),
    (685254.994948, 3837423, 0),
    (686276.82422, 3911773, 0),
    (686275.989844, 3980396, 0),
    (687135.954288, 4054098, 0),
    (687130.259758, 4122776, 0),
    (687867.12419, 4195984, 0),
    (687870.008834, 4264790, 0),
    (688525.191155, 4337704, 0),
    (688526.68451, 4406566, 0),
    (689127.905567, 4479326, 0),
    (689122.856397, 4548206, 0),
    (689681.681885, 4620862, 0),
    (689680.177116, 4689820, 0),
    (690203.656009, 4762400, 0),
    (690206.189674, 4831438, 0),
    (690694.369776, 4903926, 0),
    (690686.841099, 4972940, 0),
    (691158.395787, 5045451, 0),
    (691156.513465, 5114553, 0),
    (691597.779393, 5186977, 0),
    (691597.774019, 5256137, 0),
    (692003.693225, 5328423, 0),
    (692009.084277, 5397665, 0),
    (692406.675997, 5470007, 0),
    (692409.903761, 5539273, 0),
    (692795.326733, 5611637, 0),
    (692794.362138, 5680908, 0),
    (693173.8194, 5753337, 0),
    (693169.388533, 5822617, 0),
    (693530.885442, 5895007, 0),
    (693530.463757, 5964356, 0),
    (693876.742657, 6036721, 0),
    (693878.426339, 6106125, 0),
    (694202.849896, 6178399, 0),
    (694213.260936, 6247913, 0),
    (694524.827235, 6320170, 0),
    (694540.12964, 6389763, 0),
    (694838.569315, 6461993, 0),
    (694856.104644, 6531641, 0),
    (695135.622901, 6603783, 0),
    (695164.108267, 6673569, 0),
    (695425.993761, 6745627, 0),
    (695466.028842, 6815561, 0),
    (695720.896129, 6887631, 0),
    (695755.61983, 6957552, 0),
    (696009.190709, 7029688, 0),
    (696039.008649, 7099593, 0),
    (696282.396799, 7171704, 0),
    (696318.483641, 7241708, 0),
    (696555.509634, 7313828, 0),
    (696593.115582, 7383882, 0),
    (696823.186105, 7456004, 0),
    (696860.274848, 7526086, 0),
    (697086.321729, 7598236, 0),
    (697123.315008, 7668352, 0),
    (697338.743326, 7740456, 0),
    (697383.784829, 7810694, 0),
    (697587.162595, 7882730, 0),
    (697637.505001, 7953062, 0),
    (697832.22429, 8025066, 0),
    (697888.906627, 8095506, 0),
    (698076.436161, 8167490, 0),
    (698136.664776, 8238008, 0),
    (698322.771773, 8310036, 0),
    (698380.263538, 8380558, 0),
    (698564.519266, 8452626, 0),
    (698619.412784, 8523152, 0),
    (698804.111523, 8595286, 0),
    (698855.990073, 8665810, 0),
    (699044.801844, 8738056, 0),
    (699088.096231, 8808506, 0),
    (699280.68746, 8880860, 28853),
    (699318.485205, 8951272, 0),
    (698802.454537, 9014546, 0),
    (698816.789754, 9084614, 165233),
    (698817.87005, 9154510, 0),
    (697831.515482, 9211371, 0),
    (697880.216835, 9281802, 0),
    (697879.354012, 9351578, 0),
    (697882.480361, 9421408, 67163),
    (697882.292572, 9491194, 0),
    (697423.439341, 9554696, 0),
    (697446.159919, 9624752, 0),
    (697455.049404, 9694620, 0),
    (697458.661504, 9764416, 0),
    (697461.624335, 9834204, 0),
    (697462.076583, 9903956, 0),
    (697463.600206, 9973724, 0),
    (697463.751102, 10043474, 0),
    (697464.738987, 10113234, 0),
    (697464.920622, 10182983, 0),
    (697465.600095, 10252740, 0),
    (697465.834796, 10322490, 0),
    (697466.305871, 10392244, 0),
    (697466.590645, 10461994, 0),
    (697466.930998, 10531746, 0),
    (697467.246222, 10601498, 0),
    (697467.510732, 10671248, 0),
    (697467.83002, 10741000, 0),
    (697468.052896, 10810750, 0),
    (697468.373383, 10880502, 0),
    (697468.55937, 10950252, 0),
    (697468.875646, 11020004, 0),
    (697469.040707, 11089753, 0),
    (697469.348574, 11159504, 0),
    (697469.495024, 11229254, 0),
    (697469.802, 11299006, 0),
    (697469.934438, 11368755, 0),
    (697470.236967, 11438507, 0),
    (697470.349922, 11508256, 0),
    (697470.654112, 11578008, 0),
    (697470.75985, 11647756, 0),
    (697471.055506, 11717509, 0),
    (697471.153663, 11787258, 0),
    (697471.445093, 11857010, 0),
    (697471.533534, 11926758, 0),
    (697471.824797, 11996510, 0),
    (697471.905478, 12066259, 0),
    (697472.19333, 12136012, 574256),
    (697472.270073, 12205760, 0),
    (690491.362536, 12152643, 0),
    (692792.18378, 12262416, 0),
    (690478.794413, 12290518, 0),
    (692793.283508, 12400995, 0),
    (690530.657254, 12429547, 0),
    (692794.404783, 12539574, 0),
    (690580.805916, 12568566, 0),
    (692795.504449, 12678153, 0),
    (690629.225956, 12707573, 0),
    (692796.657485, 12816734, 0),
    (690676.074622, 12846570, 0),
    (692797.73975, 12955313, 0),
    (690721.530263, 12985560, 0),
    (692798.881653, 13093894, 0),
    (690765.727132, 13124544, 0),
    (692800.035792, 13232476, 0),
    (690808.744569, 13263523, 0),
    (692801.138572, 13371057, 0),
    (690850.540406, 13402496, 0),
    (692802.305613, 13509640, 0),
    (690891.207499, 13541462, 0),
    (692803.463249, 13648223, 0),
    (690930.897929, 13680426, 0),
    (692804.623172, 13786806, 0),
    (690969.737193, 13819389, 0),
    (692805.864343, 13925392, 0),
    (691007.473422, 13958345, 0),
    (692806.908119, 14063975, 0),
    (691044.445873, 14097301, 0),
    (692808.116066, 14202561, 0),
    (691080.520032, 14236253, 0),
    (692809.366246, 14341148, 0),
    (691116.033212, 14375207, 0),
    (692810.586195, 14479735, 0),
    (691150.565157, 14514156, 0),
    (692811.797751, 14618323, 0),
    (691184.509412, 14653105, 0),
    (692813.005448, 14756911, 0),
    (691217.956672, 14792059, 0),
    (692814.207212, 14895499, 0),
    (691250.587477, 14931007, 0),
    (692815.421111, 15034089, 0),
    (691282.642995, 15069955, 0),
    (692816.713994, 15172681, 0),
    (691314.271546, 15208908, 0),
    (692817.977506, 15311271, 0),
    (691345.160845, 15347857, 0),
    (692819.16215, 15449861, 0),
    (691375.663104, 15486809, 0),
    (692820.426244, 15588453, 0),
    (691405.741061, 15625764, 0),
    (692821.791549, 15727049, 0),
    (691435.301909, 15764719, 0),
    (692822.946719, 15865639, 0),
    (691464.345827, 15903674, 0),
    (692824.303525, 16004235, 0),
    (691493.012101, 16042632, 0),
    (692825.516623, 16142829, 0),
    (691521.275947, 16181592, 0),
    (692826.908044, 16281427, 0),
    (691549.16279, 16320555, 0),
    (692828.175241, 16420022, 0),
    (691576.697107, 16459519, 0),
    (692829.519953, 16558619, 0),
    (691603.909546, 16598488, 0),
    (692830.75103, 16697215, 0),
    (691630.760609, 16737459, 0),
    (692832.177881, 16835816, 0),
    (691657.326903, 16876433, 0),
    (692833.497221, 16974415, 0),
    (691683.643599, 17015412, 0),
    (692834.854713, 17113015, 0),
    (691709.600988, 17154392, 0),
    (692836.112697, 17251613, 0),
    (691735.231556, 17293375, 0),
    (692837.540275, 17390217, 0),
    (691760.842679, 17432367, 0),
    (692838.817404, 17528816, 0),
    (691786.087524, 17571361, 0),
    (692840.230894, 17667420, 0),
    (691811.082112, 17710358, 0),
    (692841.619637, 17806024, 0),
    (691835.788911, 17849357, 0),
    (692843.002345, 17944628, 0),
    (691860.452073, 17988365, 0),
    (692844.422489, 18083233, 0),
    (691884.722633, 18127374, 0),
    (692845.860495, 18221841, 0),
    (691909.073447, 18266393, 0),
    (692847.237208, 18360446, 0),
    (691933.211257, 18405417, 0),
    (692848.651188, 18499053, 0),
    (691957.130523, 18544445, 0),
    (692850.118997, 18637663, 0),
    (691980.80047, 18683476, 0),
    (692851.597702, 18776273, 0),
    (692004.554279, 18822518, 0),
    (692852.965614, 18914881, 0),
    (692028.250918, 18961569, 0),
    (692854.512837, 19053493, 0),
    (692051.646669, 19100619, 0),
    (692855.969506, 19192105, 0),
    (692074.918072, 19239678, 0),
    (692857.426292, 19330718, 0),
    (692098.266292, 19378746, 0),
    (692858.985868, 19469333, 0),
    (692121.620567, 19517825, 0),
    (692860.470401, 19607946, 0),
    (692144.93609, 19656912, 0),
    (692861.967172, 19746562, 0),
    (692168.328775, 19796010, 0),
    (692863.49414, 19885178, 0),
    (692191.473132, 19935110, 0),
    (692865.095482, 20023796, 0),
    (692214.787464, 20074224, 0),
    (692866.660861, 20162415, 0),
    (692238.16525, 20213350, 0),
    (692868.28802, 20301036, 0),
    (692261.57694, 20352486, 0),
    (692869.848642, 20439656, 0),
    (692285.124009, 20491635, 0),
    (692871.440749, 20578276, 0),
    (692308.776342, 20630797, 0),
    (692873.09753, 20716900, 0),
    (692332.625617, 20769974, 0),
    (692874.76609, 20855526, 0),
    (692356.735374, 20909168, 0),
    (692876.452034, 20994152, 0),
    (692380.950333, 21048376, 0),
    (692878.083556, 21132776, 0),
    (692405.439307, 21187602, 0),
    (692879.856116, 21271406, 0),
    (692430.427278, 21326852, 0),
    (692881.616483, 21410036, 0),
    (692455.962999, 21466130, 0),
    (692883.435595, 21548670, 0),
    (692481.725759, 21605425, 0),
    (692885.181431, 21687302, 0),
    (692508.105995, 21744750, 0),
    (692887.108697, 21825939, 0),
    (692535.237843, 21884108, 0),
    (692888.943494, 21964575, 0),
    (692563.498421, 22023514, 0),
    (692890.782642, 22103211, 0),
    (692592.746575, 22162964, 0),
    (692892.854352, 22241856, 0),
    (692623.6415, 22302476, 0),
    (692894.849515, 22380499, 0),
    (692656.403952, 22442063, 0),
    (692896.907544, 22519145, 0),
    (692692.041139, 22581756, 0),
    (692899.046792, 22657794, 0),
    (696758.738808, 22853682, 0),
    (692902.855575, 22796498, 0),
    (696767.954267, 22993338, 0),
    (693214.621093, 22945399, 0),
    (696770.288848, 23132768, 0),
    (693586.671564, 23096432, 0),
    (696771.359624, 23272158, 0),
    (694136.486775, 23253568, 0),
    (696772.108543, 23411538, 0),
    (696772.217422, 23481219, 0),
    (696772.71235, 23550912, 0),
    (696772.965878, 23620598, 0),
    (696773.350526, 23690290, 0),
    (696773.5471, 23759972, 0),
    (696773.927709, 23829664, 828442),
    (696774.067183, 23899346, 753404),
    (689190.260199, 23708140, 0),
    (691093.610744, 23842725, 0),
    (695351.186972, 24059146, 0),
    (691096.448817, 23981042, 0),
    (695361.912273, 24198590, 0),
    (691155.836876, 24121334, 0),
    (695364.591234, 24337756, 0),
    (691218.726485, 24261772, 0),
    (695365.825427, 24476872, 0),
    (691286.181232, 24402397, 0),
    (695366.696115, 24615976, 0),
    (691359.269655, 24543250, 0),
    (695367.396193, 24755074, 0),
    (691439.769422, 24684396, 0),
    (695367.995817, 24894170, 0),
    (691530.541141, 24825942, 0),
    (695368.53172, 25033262, 0),
    (691637.380082, 24968104, 0),
    (695369.017475, 25172354, 0),
    (691776.311082, 25111476, 0),
    (695369.467342, 25311444, 0),
    (695369.458516, 25380980, 0),
    (695369.89211, 25450534, 0),
    (695370.021617, 25520075, 0),
    (695370.407341, 25589626, 0),
    (695370.490031, 25659166, 0),
    (695370.898506, 25728718, 0),
    (695370.949261, 25798257, 0),
    (695371.360071, 25867810, 0),
    (695371.396743, 25937348, 0),
    (695371.798443, 26006900, 0),
    (695371.829404, 26076438, 0),
    (695372.216622, 26145990, 0),
    (695372.24607, 26215529, 0),
    (695372.623481, 26285080, 0),
    (695372.647128, 26354618, 0),
    (695373.0161, 26424170, 0),
    (695373.037785, 26493708, 0),
    (695373.398717, 26563258, 0),
    (695373.41589, 26632797, 0),
    (695373.770358, 26702348, 0),
    (695373.785467, 26771886, 0),
    (695374.131434, 26841436, 0),
    (695374.146647, 26910974, 0),
    (695374.485548, 26980526, 0),
    (695374.496651, 27050062, 0),
    (695374.830674, 27119614, 0),
    (695374.841527, 27189152, 0),
    (695375.169175, 27258702, 0),
    (695375.181528, 27328240, 0),
    (695375.500983, 27397790, 0),
    (695375.5127, 27467327, 0),
    (695375.826346, 27536877, 0),
    (695375.838549, 27606415, 0),
    (695376.145795, 27675965, 0),
    (695376.156343, 27745503, 0),
    (695376.461784, 27815052, 0),
    (695376.46968, 27884589, 0),
    (695376.771957, 27954139, 0),
]

#tuple_list = [
#    (18750000.0, 191249814, 92180024),
#    (9712725.48108, 101012250, 1678630),
#    (9551310.57052, 101243799, 283930),
#    (9524516.89585, 102864690, 612286),
#    (9340153.71448, 102741600, 1828831),
#    (8517288.22434, 95393546, 0),
#    (7307761.0838, 83308406, 0),
#    (5061455.89796, 58712840, 0),
#    (7353781.34733, 86774549, 106),
#    (5102499.88495, 61229950, 0),
#    (7353231.4052, 89709352, 5361),
#    (5142054.93725, 63761432, 0),
#    (7282248.83158, 91756265, 0),
#    (5122062.42363, 65562350, 0),
#    (7281875.78623, 94664315, 0),
#    (5154876.60042, 68044322, 0),
#    (7282695.45115, 97588048, 0),
#    (5186414.23963, 70535183, 0),
#    (7283478.54431, 100511933, 0),
#    (5216784.39703, 73034930, 0),
#    (7284248.23502, 103436251, 0),
#    (5246072.06946, 75543386, 0),
#    (7284983.28093, 106360683, 0),
#]

print "soak compute, record measurer, non-printing"

p = measurer(7000000, 1000, 1, fast=False)
s = search(p, 0.2, 1e-7, 50, 36000)

trial_result_list = list()
integrator_data = (None, None, None, None)
for count, (rate, tx, lx) in enumerate(tuple_list):
    rate *= 2
    duration = tx / rate
    measurement = ReceiveRateMeasurement(duration, rate, tx, lx)
    print "measurement", repr(measurement)
    trial_result_list.append(measurement)
    if count in (308, 309, 310, 311, 312, 313, 314):
        result = s.measure_and_compute(10.0, 1e6, trial_result_list, 37500000.0, integrator_data)
        _, _, _, stretch, erf, integrator_data = result
        print "    stretch", stretch, "erf", erf
        print "integrator_data", repr(integrator_data)
    if count == 314:
        break
