---
# file: roles/intel/tasks/iavf.yaml

- name: Inst - Get iavf Network Adapter Driver
  get_url:
    url: "{{ intel_download_url }}/{{ intel_i40e_url[iavf] }}"
    dest: "{{ intel_extract_dir }}/iavf-{{ intel_iavf_version }}.tar.gz"
    mode: 0644
  tags:
    - intel-inst

- name: Inst - Extract iavf Network Adapter Driver
  unarchive:
    remote_src: true
    src: "{{ intel_extract_dir }}/iavf-{{ intel_iavf_version }}.tar.gz"
    dest: "{{ intel_extract_dir }}/"
    creates: "{{ intel_extract_dir }}/iavf-{{ intel_iavf_version }}"
  register: intel_driver_extracted
  tags:
    - intel-inst

- name: Inst - iavf Network Adapter Driver
  command: "{{ item }}"
  args:
    chdir: "{{ intel_extract_dir }}/iavf-{{ intel_iavf_version }}/src"
  with_items:
    - "make install"
    - "modprobe -r iavf"
    - "modprobe iavf"
  failed_when: no
  when:
    - intel_driver_extracted
  tags:
    - intel-inst
