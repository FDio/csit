version: "3"
services:
  tg-0:
    build:
      context: "base/"
      dockerfile: "Dockerfile"
    command: ["/usr/sbin/sshd","-D", "-p", "6001"]
    expose:
      - "6001"
    hostname: "{{ ansible_hostname }}"
    networks:
      tg-nw-0:
    privileged: true
    ports:
      - "6001:6001"
    restart: "always"
    shm_size: "4G"
    devices:
      - "/dev/hugepages:/dev/hugepages"
      - "/dev/vfio:/dev/vfio"
    volumes:
      - type: "bind"
        source: "/etc/sudoers"
        target: "/etc/sudoers"
      - type: "bind"
        source: "/opt/"
        target: "/opt/"
      - type: "bind"
        source: "/usr/lib/firmware/"
        target: "/usr/lib/firmware/"
  tg-1:
    build:
      context: "base/"
      dockerfile: "Dockerfile"
    command: ["/usr/sbin/sshd","-D", "-p", "6002"]
    expose:
      - "6002"
    hostname: "{{ ansible_hostname }}"
    networks:
      tg-nw-1:
    privileged: true
    ports:
      - "6002:6002"
    restart: "always"
    shm_size: "4G"
    devices:
      - "/dev/hugepages:/dev/hugepages"
      - "/dev/vfio:/dev/vfio"
    volumes:
      - type: "bind"
        source: "/etc/sudoers"
        target: "/etc/sudoers"
      - type: "bind"
        source: "/opt/"
        target: "/opt/"
      - type: "bind"
        source: "/usr/lib/firmware/"
        target: "/usr/lib/firmware/"
networks:
  tg-nw-0:
  tg-nw-1: