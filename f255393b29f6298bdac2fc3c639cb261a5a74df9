{
  "comments": [
    {
      "key": {
        "uuid": "6d4bcd1b_efe510ee",
        "filename": "bootstrap-verify-perf-DPDK.sh",
        "patchSetId": 23
      },
      "lineNbr": 16,
      "author": {
        "id": 1263
      },
      "writtenOn": "2018-08-07T14:23:55Z",
      "side": 1,
      "message": "Is this still needed?",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 16,
        "endChar": 8
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6ae9de32_00fb923a",
        "filename": "bootstrap-verify-perf-DPDK.sh",
        "patchSetId": 23
      },
      "lineNbr": 16,
      "author": {
        "id": 76
      },
      "writtenOn": "2018-08-07T15:00:37Z",
      "side": 1,
      "message": "No, but this will go away anyway. Once JJB patch will be merged.",
      "parentUuid": "6d4bcd1b_efe510ee",
      "range": {
        "startLine": 16,
        "startChar": 0,
        "endLine": 16,
        "endChar": 8
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "99b4d93e_33fdf97d",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 1,
      "author": {
        "id": 1263
      },
      "writtenOn": "2018-08-07T14:23:55Z",
      "side": 1,
      "message": "#!/bin/env bash",
      "range": {
        "startLine": 1,
        "startChar": 0,
        "endLine": 1,
        "endChar": 11
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bec3de6b_f313a926",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 1,
      "author": {
        "id": 76
      },
      "writtenOn": "2018-08-07T14:59:25Z",
      "side": 1,
      "message": "any difference? apart that environemnt could be different. not sure need to test reliability in jenkins.",
      "parentUuid": "99b4d93e_33fdf97d",
      "range": {
        "startLine": 1,
        "startChar": 0,
        "endLine": 1,
        "endChar": 11
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "114b99d5_35724de9",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 1,
      "author": {
        "id": 76
      },
      "writtenOn": "2018-08-07T15:09:35Z",
      "side": 1,
      "message": "00:00:17.649 ./bootstrap-verify-perf-DPDK.sh: ./bootstrap-verify-perf.sh: /bin/env: bad interpreter: No such file or directory\n\nSo back to previous version ;)",
      "parentUuid": "bec3de6b_f313a926",
      "range": {
        "startLine": 1,
        "startChar": 0,
        "endLine": 1,
        "endChar": 11
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "27e9f61c_2d18553c",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 1,
      "author": {
        "id": 1263
      },
      "writtenOn": "2018-08-07T15:15:09Z",
      "side": 1,
      "message": "Sorry, I had wrong path. It should be:\n#!/usr/bin/env bash\n\nhttps://stackoverflow.com/questions/21612980/why-is-usr-bin-env-bash-superior-to-bin-bash",
      "parentUuid": "114b99d5_35724de9",
      "range": {
        "startLine": 1,
        "startChar": 0,
        "endLine": 1,
        "endChar": 11
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "2c85f2f4_0997af93",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 1,
      "author": {
        "id": 76
      },
      "writtenOn": "2018-08-08T06:56:19Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "27e9f61c_2d18553c",
      "range": {
        "startLine": 1,
        "startChar": 0,
        "endLine": 1,
        "endChar": 11
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "f72d40f6_85819e21",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 15,
      "author": {
        "id": 1263
      },
      "writtenOn": "2018-08-07T14:23:55Z",
      "side": 1,
      "message": "Do we want to also use -e and -u (except when activating virtualenv)?",
      "range": {
        "startLine": 15,
        "startChar": 4,
        "endLine": 15,
        "endChar": 6
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ffbc313_2e05ef50",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 15,
      "author": {
        "id": 76
      },
      "writtenOn": "2018-08-07T14:59:25Z",
      "side": 1,
      "message": "Well yes, virtualenv is failing so i remove as set/unset during script is not very clean imo.",
      "parentUuid": "f72d40f6_85819e21",
      "range": {
        "startLine": 15,
        "startChar": 4,
        "endLine": 15,
        "endChar": 6
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "aa8728e6_20774f80",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 15,
      "author": {
        "id": 76
      },
      "writtenOn": "2018-08-08T06:56:02Z",
      "side": 1,
      "message": "\u003e Do we want to also use -e and -u (except when activating\n \u003e virtualenv)?\n\nWe do not want -e as it quits script in case of error. But sometimes the error is ok like reservation schema.\n\n-u is incompatible with virtualenv + mechanics below when variables from jenkins are unset and some condition have to happen. So i vote just for -x for verbosity and pipeline fail.",
      "parentUuid": "f72d40f6_85819e21",
      "range": {
        "startLine": 15,
        "startChar": 4,
        "endLine": 15,
        "endChar": 6
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ae4b741f_dc9cc25b",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 15,
      "author": {
        "id": 1263
      },
      "writtenOn": "2018-08-08T10:13:27Z",
      "side": 1,
      "message": "\u003e We do not want -e as it quits script in case of error.\n\nIf that is expected, you can append \"|| true\" and add a comment on why the failure is not critical for the script. In case of pybot (where we want to store the return code), \"set +e\" before as with -u.\n\n\u003e when variables from jenkins are unset and some condition have to happen.\n\nThere are two possibilities. Either the unset is expected and supported (you can use constructs such as \"${variable:-default}\" for handling that), or it is unexpected (where failing with bash-generated message is safer than using empty string instead of something crucial).",
      "parentUuid": "aa8728e6_20774f80",
      "range": {
        "startLine": 15,
        "startChar": 4,
        "endLine": 15,
        "endChar": 6
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0ee5d9c6_268abc0e",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 15,
      "author": {
        "id": 1263
      },
      "writtenOn": "2018-08-09T11:12:50Z",
      "side": 1,
      "message": "\u003e\u003e (1 comment)\n\nI prefer writing replies to line (or file) level Gerrit comments, that allows you to have several independent threads (and you have a link to them). Change level Gerrit comments append to a single thread (which is noisy already due to all the messages about new uploads and verification jobs).\n\n\u003e Same I can say can be done with opposite approach. If you expect\n\u003e some piece of code to use undef variables or exit in any case make\n\u003e that explicit and set safer -e or -u.\n\nYes, the two approaches are complementary. Carefully written code can have two forms (one with global -e, one with global +e) and still execute identically, just overrides will be in different places. If that was the case, we can simply chose the form which is easier to read, or which is shorter.\n\nBut our code is not written that carefully, so +e or -e forms differ in behavior, precisely in how they react to failure the developer was not expecting.\nIn this case, we have to discuss which is \"safer\".\n\n\u003e Specifically boostraps are\n\u003e not those we want to quit imediately from various reasons (see\n\u003e below).\n\nQuitting early can be unsafe, but that does not mean continuing after error is safer (more below).\n\n\u003e So question is more like what coding style we want to use further\n\u003e on. Explicit or implicit. With Explicit it will fail but coder\n\u003e needs to make sure that it will not fail when we do not need it\n\u003e (that is like 70% of boostrap code needs to be excluded -\n\u003e kubernetes/reservation/archiving/downloading/virtualenv maybe\n\u003e others). Implicit would be reverse logic. So fail the code when\n\u003e needed. This or that requires same effort i think.\n\nI am not familiar with that 70%. I know about reservation, but we trap EXIT to make sure we also unreserve. Virtualenv activation needs +u. Do you have scenarios to illustrate \"downloading\", \"archiving\" and \"kubernetes\"?\n\n\u003e Regarding ${variable:-default} i think this is not the case. Look\n\u003e at line 369 you want to copy aritifacts to Archive just only if\n\u003e variable is set (no defaults) so another exception from unset\n\u003e otherwise boostrap will not work on localhost.\n\nRight, but line 369 shows the correct way: ${WORKSPACE-} also does not trigger -e, and if WORKSPACE is set to empty string, we still want to skip the copy.\n\nBy the way, expressions for \"if\" and similar are immune to -e, and there are many other rules making -e less obvious and reliable [0].\n\nBut I still prefer it (together with -u and -x) for debug purposes. It is easier to spot a failure if script abruptly exits (or starts EXIT trap), rather than if the failure is followed by two pages of optimistic commands dealing with unexpected situation.\n\n[0] https://mywiki.wooledge.org/BashFAQ/105",
      "parentUuid": "ae4b741f_dc9cc25b",
      "range": {
        "startLine": 15,
        "startChar": 4,
        "endLine": 15,
        "endChar": 6
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "6ac7cf44_4739e401",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 15,
      "author": {
        "id": 76
      },
      "writtenOn": "2018-08-09T11:48:33Z",
      "side": 1,
      "message": "As \"-e\" is not consistent i do prefer to avoid it. It has too many \"it is not working under this or that condition\" per your [0] which makes it difficult and not readable code. I prefer to make clear \"|| exit\" like we do follow in here.",
      "parentUuid": "0ee5d9c6_268abc0e",
      "range": {
        "startLine": 15,
        "startChar": 4,
        "endLine": 15,
        "endChar": 6
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4ae26002_331647e3",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 15,
      "author": {
        "id": 1263
      },
      "writtenOn": "2018-08-09T11:54:36Z",
      "side": 1,
      "message": "\u003e I prefer to make clear \"|| exit\"\n\nAlright. Should I start pointing out that many lines are not checking the exit code? For example line 60.",
      "parentUuid": "6ac7cf44_4739e401",
      "range": {
        "startLine": 15,
        "startChar": 4,
        "endLine": 15,
        "endChar": 6
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "7ed4a517_e22f5809",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 15,
      "author": {
        "id": 76
      },
      "writtenOn": "2018-08-09T12:15:26Z",
      "side": 1,
      "message": "Read mkdir man please.",
      "parentUuid": "4ae26002_331647e3",
      "range": {
        "startLine": 15,
        "startChar": 4,
        "endLine": 15,
        "endChar": 6
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5c6b2f9d_897661fe",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 15,
      "author": {
        "id": 1263
      },
      "writtenOn": "2018-08-09T12:36:40Z",
      "side": 1,
      "message": "touch tmp \u0026\u0026 mkdir -p tmp || echo FAIL\n\nAlso, disk could be full, or readonly.",
      "parentUuid": "7ed4a517_e22f5809",
      "range": {
        "startLine": 15,
        "startChar": 4,
        "endLine": 15,
        "endChar": 6
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "046e3158_ec479e84",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 245,
      "author": {
        "id": 1263
      },
      "writtenOn": "2018-08-07T14:23:55Z",
      "side": 1,
      "message": "I find \"source\" more readable than just a dot.",
      "range": {
        "startLine": 245,
        "startChar": 0,
        "endLine": 245,
        "endChar": 1
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3e39cd62_0c5bcca8",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 245,
      "author": {
        "id": 76
      },
      "writtenOn": "2018-08-07T14:59:25Z",
      "side": 1,
      "message": "ok i will fix",
      "parentUuid": "046e3158_ec479e84",
      "range": {
        "startLine": 245,
        "startChar": 0,
        "endLine": 245,
        "endChar": 1
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "4bb2cd43_74e286d3",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 252,
      "author": {
        "id": 1263
      },
      "writtenOn": "2018-08-07T14:23:55Z",
      "side": 1,
      "message": "We only need to do this just before line 363.\n\nThe tag processing in between should be very quick, but we could add some slow step there later.",
      "range": {
        "startLine": 252,
        "startChar": 57,
        "endLine": 252,
        "endChar": 64
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "a55d0081_43ff5b52",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 252,
      "author": {
        "id": 76
      },
      "writtenOn": "2018-08-07T14:59:25Z",
      "side": 1,
      "message": "Hmm, intention was to have all pybot thing as close as possible for quick view.",
      "parentUuid": "4bb2cd43_74e286d3",
      "range": {
        "startLine": 252,
        "startChar": 57,
        "endLine": 252,
        "endChar": 64
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c8a169f7_fb181516",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 260,
      "author": {
        "id": 1263
      },
      "writtenOn": "2018-08-07T14:23:55Z",
      "side": 1,
      "message": "Which script, reservation or bootstrap? We are cleaning at line 278, which is towards start of the bootstrap.",
      "range": {
        "startLine": 260,
        "startChar": 14,
        "endLine": 260,
        "endChar": 29
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "e0120301_34c3cdd6",
        "filename": "bootstrap-verify-perf.sh",
        "patchSetId": 23
      },
      "lineNbr": 260,
      "author": {
        "id": 76
      },
      "writtenOn": "2018-08-07T14:59:25Z",
      "side": 1,
      "message": "bootstrap. We want to leave TB clean and also to start clean.",
      "parentUuid": "c8a169f7_fb181516",
      "range": {
        "startLine": 260,
        "startChar": 14,
        "endLine": 260,
        "endChar": 29
      },
      "revId": "f255393b29f6298bdac2fc3c639cb261a5a74df9",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2",
      "unresolved": false
    }
  ]
}